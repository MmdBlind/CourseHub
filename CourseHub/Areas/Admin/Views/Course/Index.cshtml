@model List<CourseHub.Areas.Admin.Models.ViewModels.GetAllCoursesViewModel>

@{
    var q = (ViewData["q"] as string) ?? "";
}

<div class="d-flex align-items-center justify-content-between gap-3 mb-3">
    <!-- راست: سرچ -->
    <form method="get" asp-action="Index" class="flex-grow-1" style="max-width: 640px;">
        <div class="input-group searchbar">
            <button class="btn icon-btn btn-search" type="submit" title="جستجو">
                <i class="bi bi-search"></i>
            </button>
            <input type="text"
                   name="q"
                   value="@q"
                   class="form-control text-end"
                   placeholder="نام و اسلاگ" />



            @if (!string.IsNullOrWhiteSpace(q))
            {
                <a asp-action="Index" class="btn icon-btn btn-clear" title="پاک‌کردن جستجو">
                    <i class="bi bi-x-lg"></i>
                </a>
            }
        </div>
    </form>

    <!-- چپ: دکمهٔ افزودن (کمی بزرگ‌تر) -->
    <a asp-area="Admin" asp-controller="Category" asp-action="Create"
       class="btn btn-success btn-add">
        <i class="bi bi-plus-lg"></i>
        افزودن دسته
    </a>
</div>

<div class="card-body stat-box no-hover">
    <div class="table-admin-wrap mt-4">
        <table class="table-admin compact" dir="rtl">
            <thead>
                <tr>
                    <th>عنوان</th>
                    <th>اسلاگ</th>
                    <th>دسته</th>
                    <th>قیمت</th>
                    <th>تاریخ انتشار</th>
                    <th>وضعیت</th>
                    <th>عملیات</th>
                </tr>
            </thead>
            <tbody>
                @foreach (var item in Model )
                {
                    <tr>
                        <td class="col-title">@item.CourseTitle</td>
                        <td class="col-slug">
                            <span class="slug-chip" dir="rtl">
                                @item.CourseSlug
                            </span>
                        </td>
                        <td class="col-title">
                            @item.CategoryList
                        </td>
                        <td>
                            @item.CoursePrice
                        </td>
                        <td>
                            @item.CoursePublishDate
                        </td>

                        <td>
                            @if (@item.CourseIsDelete==true)
                            {
                                <span>پیش نویش</span>
                            }
                            else
                            {
                                <span>انتشار یافته</span>
                            }
                        </td>

                        <td>
                            <a class="table-action"
                               asp-area="Admin" asp-controller="Course" asp-action="Edit" asp-route-id="@item.CourseID">
                                ویرایش
                            </a>
                            <button type="button"
                                    class="table-action table-action--danger btn btn-link p-0"
                                    data-bs-toggle="modal"
                                    data-bs-target="#confirmDeleteModal"
                                    data-id="@item.CourseID"
                                    data-name="@item.CourseTitle">
                                حذف
                            </button>
                        </td>
                    </tr>
                }
            </tbody>
        </table>
    </div>
</div>
<!-- مودال تأیید حذف: انتهای Index.cshtml -->
<div class="modal fade" id="confirmDeleteModal" tabindex="-1" aria-hidden="true" dir="rtl">
    <div class="modal-dialog modal-dialog-centered">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">تأیید حذف</h5>
                <button type="button" class="btn-close ms-0" data-bs-dismiss="modal" aria-label="بستن"></button>
            </div>
            <div class="modal-body">
                آیا از حذف <strong id="deleteName" class="text-danger"></strong> مطمئن هستید؟
                <div class="small text-secondary mt-2">این عمل ممکن است غیرقابل بازگشت باشد.</div>
            </div>
            <div class="modal-footer justify-content-between flex-row-reverse">
                <form id="deleteForm"
                      asp-area="Admin" asp-controller="Category" asp-action="Delete"
                      method="post" class="m-0">
                    @Html.AntiForgeryToken()
                    <input type="hidden" name="id" id="deleteId" />
                    <button type="submit" class="btn btn-danger">بله، حذف شود</button>
                </form>
                <button type="button" class="btn btn-outline-secondary" data-bs-dismiss="modal">انصراف</button>
            </div>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        document.addEventListener('DOMContentLoaded', function () {
          var modalEl = document.getElementById('confirmDeleteModal');
          if (!modalEl) return;

          modalEl.addEventListener('show.bs.modal', function (ev) {
            var btn  = ev.relatedTarget;                 // دکمه‌ای که مودال رو باز کرده
            var id   = btn?.getAttribute('data-id') ?? '';
            var name = btn?.getAttribute('data-name') ?? '';

            modalEl.querySelector('#deleteName').textContent = '«' + name + '»';
            modalEl.querySelector('#deleteId').value = id;  // می‌رود به input hidden فرم
          });
        });
    </script>
}